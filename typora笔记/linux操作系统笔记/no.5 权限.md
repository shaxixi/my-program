[toc]

# 权限管理操作

## 读，写，执行权限

* 读权限

  对于文件夹来说，读权限影响用户是否能够列出目录结构

  对于文件来说，读权限影响用户是否可以查看文件内容

* 写权限

  对于文件夹里说，写权限影响用户是否可以在文件夹下“创建/删除/复制到/移动到”文档。

  对于文件来说，写权限影响用户是否可以编辑文件内容。

* 执行权限

  一般都是对于文件来说，特别脚本文件。 

## 身份介绍

* owner身份（文件所有者，默认为文档的创建者）

  设置文件的权限，成为个人的“私密文件”,即个人所有者

* group身份 （与文件所有者同组的用户）

  多个团队在同一台主机上开发资源的时候

  主组和附加组：每个账户支持多个用户组，如用户a1,b1即可属于a用户组，也能属于B用户组

* other身份（其他人，相对于所有者）

  在group身份中除了owner身份意外的身份

* root用户 （超级用户）

![image-20201026092244320](C:\Users\傻兮兮乎乎\AppData\Roaming\Typora\typora-user-images\image-20201026092244320.png)

## Linux权限

### 查看文件基本属性和权限

#ls -l 路径	==	#ll 路径

<img src="C:\Users\傻兮兮乎乎\AppData\Roaming\Typora\typora-user-images\image-20201026092940845.png" alt="image-20201026092940845" style="zoom:80%;" />

**理解权限：**

![image-20201026093302522](C:\Users\傻兮兮乎乎\AppData\Roaming\Typora\typora-user-images\image-20201026093302522.png)

* 文件类型：d表示文件夹，-表示文件，l表示软连接,s表示套接字……

* 文件所有者权限；文件所属用户组权限；其他人对这个文件的权限：r表示read(可读)，w表示write(可写)，x表示execute(可执行)，-没有对应权限。按照读，写，执行的顺序，位置不会变化，均是rwx三个参数组合。 

### 权限设置

语法：#chmod 选项[^注释1] 权限模式[^注释2] 文档[^注释3]

[^注释1]:常用选项：-R：递归设置权限（当文档类型为文件夹的时候）
[^注释2]:给文档需要设置的权限信息，格式：【给谁设置】【权限分配方式】【权限字符】，（操作者要么是root用户，要么是文档的所有者
[^注释3]:可以是文件或文件夹，可以是相对路径或者绝对路径

**权限模式**

* 字母形式
  * 给谁设置：
    * u: 表示所有者身份owner（user)
    * g: 表示给所有者同组用户设置（group)
    * o: 表示others，给其他用户设置权限
    * a: 表示all，给所有人（包含ugo部分）设置权限
    * 没有指定，默认为给所有用户设置

  * 权限分配方式：
    * +： 表示给具体的用户新增权限（相对当前）
    * -： 表示删除用户的权限（相对当前)
    * =： 表示将权限设置成具体的值(注重结果)

  * 权限字符：
    * r: 读
    * w: 写
    * x: 执行 当所有者有执行权限时，文档会变成绿色

~~~python
# chmod u+x g+rw o+r text_1
# chmod a=x text_2
# chmod u-r g-w o-x text_3
~~~

* 数字形式
  *  读：r		4
  * 写：w        2
  * 执行：x     1

| 数值 |         权限         | 目录列表 |
| :--: | :------------------: | :------: |
|  0   | 不可读不可写不可执行 |   ---    |
|  1   |  不可读不可写可执行  |   --x    |
|  2   |  不可读可写不可执行  |   -w-    |
|  3   |   不可读可写可执行   |   -wx    |
|  4   |  可读不可写不可执行  |   r--    |
|  5   |   可读不可写可执行   |   r-x    |
|  6   |   可读可写不可执行   |   rw-    |
|  7   |    可读可写可执行    |   rwx    |

~~~python
# chmod 754 text_1
# chmod 713 text_1	#奇葩权限
'''
在写权限的时候千万不要设置“奇葩权限”，如果一个权限数字中但凡出现2与3的数字，则会出现不合理的情况
'''
~~~

> 在Linux中，如果要删除一个文件，不是看文件有没有对应的权限，而是看文件所在的目录是否有写权限。如果有，才可以删除

# 属主与主组设置

* 属主：所属的用户（文件的主人，文件的创建者）
* 属组：所属的用户组（创建者所在的主组）

<img src="C:\Users\傻兮兮乎乎\AppData\Roaming\Typora\typora-user-images\image-20201028193751583.png" alt="image-20201028193751583" style="zoom: 80%;" />

* 属主和属组信息的修改

  * chown

    * 作用: 更改文件的所属用户

      语法：chown -R username 文档路径

      案例：`#chown text oo/`

    * 作用：更改文件的所属用户和所属用户组（频率高）

      语法：chown -R username:groupname 文档路径

      案例：`#chown root:root oo/` 

  * chgrp（了解）

    * 作用：更改文档的所属用户组

      语法： chgrp -R groupname 文档路径

      案例： `#chgrp text oo/`

# sudo

> sudo可以让管理员（root)事先定义某些特殊命令谁可以执行。
>
> 默认sudo中是没有除root之外的用户的规则，想要使用则先配置sudo
>
> sudo不是任何Linux分支都有的命令，常见centos与ubuntu都存在sudo命令

## 修改sudo配置

* sudo配置文件：`/etc/sudoers`（无法编辑）

  * 配置sudo文件使用`#visudo`,打开之后于vim操作一致

  * 配置普通用户的权限

    <img src="C:\Users\傻兮兮乎乎\AppData\Roaming\Typora\typora-user-images\image-20201028200909308.png" alt="image-20201028200909308"  />

    > root 表示 用户名，如果是用户组，则可以写成“%组名”
    >
    > ALL：表示允许登入的主机（地址白名单）
    >
    > (ALL)：表示以谁的身份执行，ALL表示root身份
    >
    > ALL：表示当前用户可以执行的命令，多个命令可以使用 “,” 分割

  * 编辑sudo的配置文件

    ![image-20201028224437055](C:\Users\傻兮兮乎乎\AppData\Roaming\Typora\typora-user-images\image-20201028224437055.png)

    * 在写sudo规则的时候不建议写直接形式的命令，而是写命令的完整路径。使用 which 查看，`#which 指令名称`

    *  为了方便查看完成路径，可以在末行模式下用`:!which 指令名称`

    * 禁止修改某用户指令的配置

      ![image-20201028230920082](C:\Users\傻兮兮乎乎\AppData\Roaming\Typora\typora-user-images\image-20201028230920082.png)

      >  先允许修改所有用户`[A-Za-z]*`配置`指令完整路径 [A-Za-z]*`，再排除禁止修改的用户配置`!指令完整路径 用户名`



## 使用sudo规则

* 再root用户添加好对应的规则之后就可以切换用户，切换到普通用户，再去执行。
* 语法：`#sudo 需要执行的指令`
* 在输入sudo指令之后需要输入当前的用户密码进行确认的操作（不是root用户密码),输入之后在接下来5分钟内再次执行sudo指令不需要密码
* 在普通用户下查看自己具有的特殊权限`#sudo -l`

## 习题

给普通用户设置一个关机命令执行权限。